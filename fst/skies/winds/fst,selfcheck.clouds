use functions in branches as much as possible